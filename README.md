# turntable_to_images

「動画をブラウザで再生しながら縮小フレームを吸い出す → OpenCV.js（Worker内）でFarneback光学フロー → グリッド中央値で角速度ω推定→積分でθ→等角度でフレーム選択 → ZipでDL」。


Turntable Frame Splitter
これは何をするものか

ターンテーブル上の料理などが 1周だけ回転する動画 から、
回転角度を基準に均等な枚数の静止画を抽出するツール です。

フレーム番号で等間隔に切り出すのではなく、
動画内の実際の回転量を推定して「角度で均等」に分割します。

開始と終了は静止

加速 → 等速 → 減速（S字カーブ）

全尺でちょうど1周

といった非線形な回転にも対応します。

PCブラウザ（Chrome/Edge）で動作し、
GitHub Pagesなどの静的ホスティングでそのまま利用可能です。

仕組み（簡易説明）

処理はすべてブラウザ内で完結します。

1. 動画フレーム取得

動画をブラウザで再生しながらフレームを取得

解析用に縮小（例：長辺480px）

必要に応じてフレーム間引き

2. 角速度の推定（光学フロー）

各フレーム間で以下を行います：

OpenCV.js の Farneback Optical Flow でピクセル移動ベクトルを計算

画像全体をグリッド分割

各グリッド点で

中心からの半径ベクトル r

接線方向単位ベクトル t

角速度近似値

ω ≈ (flow ・ t) / r


全グリッド点の ω の 中央値 を採用

中央値を使うことで、

反射

料理の変形

ノイズ

局所的な誤検出

に強くなっています。

3. 角度 θ の計算

各フレームの角速度 ω を積分して角度 θ を求めます。

θ[i] = Σ ω[i]


その後、最終フレームが 2π（1周）になるよう正規化します。

4. 均一角度サンプリング

指定した枚数 N に対して

0, 2π/N, 2×2π/N, ... 


の角度に最も近いフレームを選択し、PNGで出力します。

特徴

サーバ不要（完全クライアントサイド）

GitHub Pages対応

S字カーブの回転でも均等分割可能

中心クリック指定可能

グリッド間隔や解析解像度を調整可能

制限事項

PCブラウザ前提（モバイルは非推奨）

長時間動画や4K動画は非対応

出力は解析解像度（最短実装のため）

想定用途

ターンテーブル撮影素材の均等角度サンプリング

商品画像生成

3D再構成用の角度均等フレーム取得

1周ループ動画の正確な分割

必要であれば、

元解像度での再キャプチャ版

停止区間自動検出

回転方向自動判定

なども拡張可能です。


もしOpenCV.jsの読み込みが失敗したら（たまにある）

原因は「Worker内で docs.opencv.org から opencv.wasm を取るときの挙動」だったりする。

その場合はOpenCVをリポジトリに同梱するのが確実：

ここから2ファイルを落として repo 直下に置く

opencv.js

opencv.wasm

worker.js の importScripts(...) をこれに変更

importScripts("./opencv.js");


それだけでOK（WASMは同じ場所から相対ロードされる）



使い方のコツ（失敗しにくい設定）

解析解像度（長辺）: 480 くらいがバランス良い

グリッド間隔: 24〜32（速さ優先なら32）

中心はなるべく正確にクリック（ズレると角速度推定が崩れる）

料理が「のっぺり」でフローが弱い場合は

解析解像度を 640 に上げる

グリッドを 16〜24 にする